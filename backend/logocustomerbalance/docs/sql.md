
SELECT 
    CLC.CODE "Cari Kodu", 
    CLC.DEFINITION_ "Cari Açıklaması",
    CASE WHEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) > 0 
        THEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) 
        ELSE 0 
    END "BakiyeBorc",
    CASE WHEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) < 0 
        THEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) * -1  
        ELSE 0 
    END "BakiyeAlacak"
FROM 
    LG_002_01_CLFLINE CLF -- 2024 yılına ait tabloya güncellendi
LEFT OUTER JOIN 
    LG_002_CLCARD CLC ON (CLF.CLIENTREF = CLC.LOGICALREF)
WHERE 
    CLC.CARDTYPE <> 22
    AND CLF.CANCELLED = 0
    AND CLC.CODE LIKE '120%' 
 AND CLC.CODE NOT IN (
        '120.62.01.L001',
        '120.62.01.S001',
        '120.60.01.U002',
        '120.60.01.G005',
        '120.60.01.E005',
        '120.60.01.S004',
        '120.60.04.B001',
        '120.60.01.E011'
    )
GROUP BY
    CLC.CODE, 
    CLC.DEFINITION_,
    CLC.SPECODE,
    CLC.CYPHCODE
HAVING 
    ABS(SUM(CASE WHEN SIGN = 0 THEN AMOUNT ELSE AMOUNT * -1 END)) > 0;