SELECT 
    CLC.CODE "Cari Kodu", 
    CLC.DEFINITION_ "Cari Açıklaması",
    CASE WHEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) > 0 
        THEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) 
        ELSE 0 
    END "BakiyeBorc",
    CASE WHEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) < 0 
        THEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) * -1  
        ELSE 0 
    END "BakiyeAlacak"
FROM 
    LG_002_01_CLFLINE CLF -- 2024 yılına ait tabloya güncellendi
LEFT OUTER JOIN 
    LG_002_CLCARD CLC ON (CLF.CLIENTREF = CLC.LOGICALREF)
WHERE 
    CLC.CARDTYPE <> 22
    AND CLF.CANCELLED = 0
    AND CLC.CODE LIKE '320%' -- 320 ile başlayan tedarikçiler filtreleniyor
GROUP BY
    CLC.CODE, 
    CLC.DEFINITION_,
    CLC.SPECODE,
    CLC.CYPHCODE
HAVING 
    ABS(SUM(CASE WHEN SIGN = 0 THEN AMOUNT ELSE AMOUNT * -1 END)) > 0
    AND SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END) < -10 -- BakiyeAlacak > 10 koşulu
ORDER BY 
    CASE WHEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) < 0 
        THEN (SUM(CASE WHEN SIGN=0 THEN AMOUNT ELSE AMOUNT*-1 END )) * -1  
        ELSE 0 
    END DESC; -- BakiyeAlacak Z-A sıralaması
